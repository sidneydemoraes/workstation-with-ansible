- name: Install and setup GoG
  tags:
    - games
    - gog
  block:
    - name: Get latest GoG installer URL
      uri:
        url: "{{ github_api_first_part }}/{{ gog_repo }}/{{ github_api_last_part }}"
        return_content: yes
      register: "{{ gog_latest }}"

    - name: Install package
      loop: "{{ gog_latest.json.assets }}"
      when: "'.deb' in item.name"
      become: yes
      apt:
        deb: "{{ item.browser_download_url }}"


- name: Install and setup Epic
  tags:
    - games
    - epic
  block:
    - name: Get latest Epic installer URL
      uri:
        url: "{{ github_api_first_part }}/{{ epic_repo }}/{{ github_api_last_part }}"
        return_content: yes
      register: "{{ epic_latest }}"

    - name: Install package
      loop: "{{ epic_latest.json.assets }}"
      when: "'.deb' in item.name"
      become: yes
      apt:
        deb: "{{ item.browser_download_url }}"


- name: Install Steam
  tags:
    - games
    - steam
  block:
    - name: Get Steam installer
      get_url: 
        url: "{{ steam_url }}"
        dest: "{{ steam_dest }}"
      check_mode: no

    - name: Install package
      become: yes
      apt:
        deb: "{{ steam_dest }}"

    - name: Remove installer
      file:
        path: "{{ steam_dest }}"
        state: absent
      check_mode: no
